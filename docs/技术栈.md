# 🛠️ PodFlow 技术栈文档 (Tech Stack)

本项目采用 **前后端分离 (Client-Server)** 架构，遵循 **本地优先 (Local-First)** 原则。旨在利用现代 Web 技术构建流畅的用户体验，同时通过本地 AI 模型确保数据隐私与零边际成本。

### 🖥️ 前端 (Frontend)

> **职责：** 负责界面渲染、用户交互、音频播放以及向后端发起数据请求。

* **React (构建于 Vite):**
* **作用：** 项目的骨架。Vite 提供了极速的开发环境启动和打包体验，React 负责构建响应式的组件化界面（如左右分栏、笔记跟随）。


* **MUI (Material UI):**
* **作用：** 项目的“装修”。使用 Google 风格的现成组件库（按钮、滑块、卡片、导航栏），避免陷入手写 CSS 的时间黑洞，确保 V1 版本界面整洁专业。


* **Axios:**
* **作用：** 前后端的“联络员”。比原生 fetch 更智能，自动处理 JSON 数据转换和错误拦截，负责将用户的操作（如“保存笔记”）发送给 Python 后端。



### ⚙️ 后端 (Backend)

> **职责：** 负责业务逻辑处理、AI 模型调用、文件管理及数据库读写。

* **Python (3.8+):**
* **作用：** 核心逻辑语言。因其在 AI 领域的绝对统治力，用于串联所有智能功能。


* **FastAPI:**
* **作用：** 高性能 Web 框架。它像一个交通枢纽，定义了标准的 HTTP 接口（API），让前端可以通过 URL（如 `/transcribe`）来指挥后端干活。自带的 Swagger 文档方便调试。


* **SQLAlchemy:**
* **作用：** 数据库管理工具 (ORM)。充当“翻译官”，让我们能用 Python 代码直接操作数据库对象，而无需编写易错的 SQL 语句，提高了代码的可维护性和安全性。



### 🧠 核心能力 (Core & AI)

> **职责：** 实现产品的核心价值——听写与存储。

* **WhisperX (Local):**
* **作用：** 离线语音识别模型（基于 OpenAI Whisper 的增强版）。直接在用户设备上运行，将 MP3 精准转录为带时间戳的文本，支持说话人区分（Diarization）。**零 API 成本，且无需上传音频到云端。**


* **FFmpeg:**
* **作用：** 多媒体处理引擎。幕后的脏活累活处理者，负责在转录前将各种复杂的音频格式统一压缩、转换，确保 Whisper 能顺利读取。


* **SQLite:**
* **作用：** 嵌入式数据库。整个应用的所有数据（字幕、笔记、生词）都存储在一个本地的 `.db` 文件中。无需安装服务器，即插即用，方便备份与迁移。


### ⚠️ 硬件兼容性说明 (RTX 5070 专用补丁)

> **适用范围：** 仅针对 RTX 5070 显卡 + PyTorch Nightly 版本

**为什么需要兼容性补丁？**

RTX 5070 是 NVIDIA 的新款显卡，需要使用最新开发版的 CUDA（CUDA 13.0+）才能充分发挥性能。这导致了版本兼容性挑战：

1. **版本匹配要求**：
   - RTX 5070 → 需要 CUDA 13.0+
   - CUDA 13.0 → 需要使用 PyTorch Nightly（开发版）
   - PyTorch Nightly → API 不稳定，部分 API 被移除或重构
   - WhisperX → 依赖旧版 PyTorch API

2. **具体兼容性问题**：
   - **PyTorch 2.6+ 安全限制**：默认 `weights_only=True`，WhisperX 模型文件包含 Omegaconf 对象无法加载
   - **torchaudio API 变更**：Nightly 版本中 `AudioMetaData`、`list_audio_backends()` 等 API 被移除
   - **pyannote 模型加载**：依赖的模型文件需要兼容旧版 PyTorch 序列化格式

3. **解决方案**：
   - 创建 `app/utils/hardware_patch.py` 模块
   - 通过 Monkey Patch 方式修复不兼容的 API
   - 在应用启动时（导入 WhisperX 之前）自动应用补丁
   - 补丁具有幂等性，多次调用安全

**注意事项**：
- 这些补丁**仅针对 RTX 5070 + PyTorch Nightly 环境**
- 其他显卡或 PyTorch 稳定版环境可以正常使用（补丁会安全跳过）
- 所有补丁都有异常处理，即使失败也不会影响其他功能



### 🔧 基础设施 (Infrastructure)

> **职责：** 支撑开发环境与远程访问。

* **Node.js (LTS):**
* **作用：** 仅作为构建工具的运行环境。它负责把 React 代码“编译”成浏览器能懂的文件，**不参与**实际的业务逻辑运行。


* **Tailscale:**
* **作用：** 安全隧道。在不暴露公网 IP 的前提下，建立加密的虚拟局域网，实现 iPad/手机在户外对家中 PC 服务的安全访问。



---

### 💡 为什么这么选？(Design Philosophy)

* **简单至上 (Simplicity):** 移除了 Docker、LangChain 等对于 MVP 阶段过于复杂的工具，降低认知负担。
* **成本为零 (Zero Cost):** 通过本地 Whisper + SQLite，避免了昂贵的云数据库和 Token 计费，适合个人长期使用。
* **体验优先 (UX First):** 选择 React + MUI 而非纯 Python GUI，是为了实现更细腻的富文本交互和多端（iPad）适配能力。